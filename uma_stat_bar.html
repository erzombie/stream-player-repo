<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Uma Stat Bar Overlay</title>
  <style>
    :root{
      --font:'Roboto',system-ui,-apple-system,'Segoe UI',Arial,sans-serif;
      --num:#4a2c0a;
      --header:#3b2412;
      --cream:#f7efe2;
      --divider:#d8cbb6;
      --fxMs:900ms;         /* chevron/number move duration */
    }

    html,body{margin:0;background:transparent}
    body{font-family:var(--font);color:var(--num)}

    /* wrapper */
    #barWrapper{
      display:flex;gap:0;margin:20px auto;width:max-content;
      border-radius:12px;overflow:hidden;box-shadow:0 10px 24px rgba(0,0,0,.25);
    }

    /* each stat cell */
    .stat{
      position:relative;display:flex;flex-direction:column;align-items:center;
      background:var(--cream);border-right:1px solid var(--divider);
      min-width:140px; overflow:hidden;  /* clip chevron inside */
    }
    .stat:last-child{border-right:none}

    /* label row (PNG on dark brown strip) */
    .label{width:100%;height:34px;display:flex;align-items:center;justify-content:center;background:var(--header)}
    .label img{height:100%;width:auto;display:block;filter:drop-shadow(0 1px 3px rgba(0,0,0,.25))}

    /* number row */
    .value{
      position:relative;z-index:4;  /* above chevron */
      font-weight:900;font-size:32px;line-height:1;
      padding:10px 0 12px; text-align:center; min-width:80px;
    }
    .value.pop{animation:valPop .45s ease-out}
    @keyframes valPop{0%{transform:scale(.92)}60%{transform:scale(1.1)}100%{transform:scale(1)}}

    /* move number with direction (subtle) */
    @keyframes riseVal{0%{transform:translateY(-6%) scale(.98)}80%{transform:translateY(-24%)}100%{transform:translateY(-30%)}}
    @keyframes dropVal{0%{transform:translateY(-24%) scale(.98)}80%{transform:translateY(4%)}100%{transform:translateY(10%)}}
    .value.moveUp{animation:riseVal var(--fxMs) cubic-bezier(.2,.9,.2,1)}
    .value.moveDown{animation:dropVal var(--fxMs) cubic-bezier(.2,.9,.2,1)}

    /* FX (chevron) area â€” sits above number but clipped by .stat */
    .fx{position:absolute;left:0;right:0;top:34px;bottom:0;pointer-events:none;z-index:3}
    .fx img.chev{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      height:34px;opacity:.85;filter:drop-shadow(0 8px 18px rgba(0,0,0,.35));
    }
    @keyframes rise{
      0%{transform:translate(-50%,-10%) scale(.92);opacity:0}
      20%{opacity:1}
      80%{transform:translate(-50%,-110%) scale(1.04);opacity:1}
      100%{transform:translate(-50%,-150%) scale(1);opacity:0}
    }
    @keyframes drop{
      0%{transform:translate(-50%,-90%) scale(.92);opacity:0}
      20%{opacity:1}
      80%{transform:translate(-50%,25%) scale(1.04);opacity:1}
      100%{transform:translate(-50%,70%) scale(1);opacity:0}
    }
    .animUp{animation:rise var(--fxMs) cubic-bezier(.2,.9,.2,1) forwards}
    .animDown{animation:drop var(--fxMs) cubic-bezier(.2,.9,.2,1) forwards}
  </style>
</head>
<body>
  <div id="barWrapper">
    <div class="stat" id="s_Speed">
      <div class="label"><img src="https://erzombie.github.io/stream-player-repo/uma_overlay/bar_speed.png" alt="Speed"></div>
      <div class="value" id="val_Speed">0</div>
      <div class="fx" id="fx_Speed"></div>
    </div>
    <div class="stat" id="s_Stamina">
      <div class="label"><img src="https://erzombie.github.io/stream-player-repo/uma_overlay/bar_stamina.png" alt="Stamina"></div>
      <div class="value" id="val_Stamina">0</div>
      <div class="fx" id="fx_Stamina"></div>
    </div>
    <div class="stat" id="s_Power">
      <div class="label"><img src="https://erzombie.github.io/stream-player-repo/uma_overlay/bar_power.png" alt="Power"></div>
      <div class="value" id="val_Power">0</div>
      <div class="fx" id="fx_Power"></div>
    </div>
    <div class="stat" id="s_Guts">
      <div class="label"><img src="https://erzombie.github.io/stream-player-repo/uma_overlay/bar_guts.png" alt="Guts"></div>
      <div class="value" id="val_Guts">0</div>
      <div class="fx" id="fx_Guts"></div>
    </div>
    <div class="stat" id="s_Wit">
      <div class="label"><img src="https://erzombie.github.io/stream-player-repo/uma_overlay/bar_wit.png" alt="Wit"></div>
      <div class="value" id="val_Wit">0</div>
      <div class="fx" id="fx_Wit"></div>
    </div>
  </div>

  <script>
    // assets
    const CHEV_UP   = 'https://erzombie.github.io/stream-player-repo/uma_overlay/uma_pos_chevron.png';
    const CHEV_DOWN = 'https://erzombie.github.io/stream-player-repo/uma_overlay/uma_neg_chevron.png';

    // smooth number tween
    function tweenNumber(el, target, dur = 900){
      const start = parseInt(el.textContent || '0', 10);
      const diff  = target - start;
      if (!diff){ el.textContent = target; return; }
      const t0 = performance.now();
      function step(t){
        const p = Math.min(1, (t - t0) / dur);
        const e = 1 - Math.pow(1 - p, 3); // easeOutCubic
        el.textContent = Math.round(start + diff * e);
        if (p < 1) requestAnimationFrame(step);
        else { el.textContent = target; el.classList.remove('pop'); void el.offsetWidth; el.classList.add('pop'); }
      }
      requestAnimationFrame(step);
    }

    // chevron only (no delta)
    function spawnChevron(fxEl, theme){
      const img = new Image();
      img.src = (theme === 'down' ? CHEV_DOWN : CHEV_UP);
      img.className = 'chev ' + (theme === 'down' ? 'animDown' : 'animUp');
      fxEl.appendChild(img);
      setTimeout(() => img.remove(), 950);
    }

    // update one stat
    function updateStat(stat, newValue, theme = 'up'){
      const valEl = document.getElementById('val_' + stat);
      const fx    = document.getElementById('fx_' + stat);
      if (!valEl || !fx) return;

      const old  = parseInt(valEl.textContent || '0', 10);
      const diff = newValue - old;
      const dirDown = (diff < 0) || (theme === 'down');

      // move number subtly in the same direction
      valEl.classList.remove('moveUp', 'moveDown'); void valEl.offsetWidth;
      valEl.classList.add(dirDown ? 'moveDown' : 'moveUp');

      tweenNumber(valEl, newValue, 900);
      spawnChevron(fx, dirDown ? 'down' : 'up');
    }

    // optional demo: add ?demo=1 to URL
    const qs = new URLSearchParams(location.search);
    if (qs.get('demo') === '1'){
      setTimeout(()=>updateStat('Speed',  120, 'up'),   600);
      setTimeout(()=>updateStat('Stamina', 87, 'up'),  1000);
      setTimeout(()=>updateStat('Power',   20, 'up'),  1400);
      setTimeout(()=>updateStat('Guts',   -40, 'down'),1800);
      setTimeout(()=>updateStat('Wit',    -30, 'down'),2200);
    }

    // Streamer.bot hook (optional)
    // window.postMessage({type:'umaStat', stat:'Speed', value:123, theme:'up'})
    window.addEventListener('message',(e)=>{
      const m = e.data || {};
      if (m.type === 'umaStat' && m.stat && typeof m.value !== 'undefined'){
        updateStat(m.stat, Number(m.value), (m.theme || 'up'));
      }
    });
  </script>
</body>
</html>
