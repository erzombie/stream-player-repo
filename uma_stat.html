<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Uma Stat Overlay</title>
  <style>
    :root {
      --uma: #ffb74d;            /* main orange */
      --umaLite: #ffd585;        /* light yellow/orange */
      --strokeLight: #ffffff;    /* white outline like game */
      --font: 'Roboto', system-ui, -apple-system, 'Segoe UI', Arial, sans-serif;
      --shadow: 0 10px 28px rgba(0,0,0,.35);
      --tileW: 260px;
      --tileH: 90px;
    }
    html,body{margin:0;height:100%;background:transparent;overflow:hidden}
    #stage{position:relative;width:100vw;height:100vh;pointer-events:none}

    .popup{position:absolute;display:flex;align-items:center;gap:.5rem;filter:drop-shadow(var(--shadow))}

    /* SVG chevron tile */
    .tile{position:relative;width:var(--tileW);height:var(--tileH)}
    .tile svg{position:absolute;inset:0;width:100%;height:100%;display:block}

    /* text on top */
    .chip{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;gap:.35rem;
          font:900 42px/1 var(--font);color:#e97700; /* orange text */
          -webkit-text-stroke: 4px var(--strokeLight); text-stroke: 4px var(--strokeLight);}
    .chip .stat{margin-left:.25rem}

    @keyframes riseFade{0%{transform:translateY(0) scale(.96);opacity:0}8%{opacity:1}70%{transform:translateY(-90px) scale(1.02);opacity:1}100%{transform:translateY(-150px) scale(1);opacity:0}}
    .anim{animation:riseFade var(--dur,1600ms) cubic-bezier(.2,.9,.2,1) forwards}
  </style>
</head>
<body>
  <div id="stage"></div>
  <audio id="sfx" preload="auto"></audio>

  <script>
  // batch-capable overlay with 2-chevron SVG backing
  const qs=new URLSearchParams(location.search);
  const STAT_POOL=['Speed','Stamina','Power','Guts','Wit'];
  const cfg={mode:qs.get('mode')||'',stat:qs.get('stat')||'Wit',amount:qs.has('amount')?parseInt(qs.get('amount')||'1',10):null,count:Math.max(1,Math.min(5,parseInt(qs.get('count')||'1',10))),concurrent:Math.max(1,Math.min(2,parseInt(qs.get('concurrent')||'2',10))),dur:parseInt(qs.get('dur')||'1600',10),sound:qs.get('sound')||'',minDelay:parseInt(qs.get('minDelay')||'60',10),maxDelay:parseInt(qs.get('maxDelay')||'180',10)};
  switch(cfg.mode){case'v1_wit5':cfg.stat='Wit';cfg.amount=1;cfg.count=5;cfg.concurrent=2;break;case'v2_guts5':cfg.stat='Guts';cfg.amount=1;cfg.count=5;cfg.concurrent=2;break;case'v3_wit1':cfg.stat='Wit';cfg.amount=1;cfg.count=1;cfg.concurrent=1;break;case'v4_random':cfg.count=Math.floor(Math.random()*5)+1;cfg.concurrent=2;break}
  const stage=document.getElementById('stage');const sfxEl=document.getElementById('sfx');if(cfg.sound)sfxEl.src=cfg.sound;
  const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;const choice=a=>a[Math.floor(Math.random()*a.length)];

  function chevronSVG(){
    // Two chevrons: back light, front orange (closer to ref)
    return `<svg viewBox="0 0 520 180" preserveAspectRatio="xMidYMid meet">
      <defs>
        <linearGradient id="g1" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" stop-color="#ffe29e"/>
          <stop offset="100%" stop-color="#ffc86d"/>
        </linearGradient>
        <linearGradient id="g2" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0%" stop-color="#ffbf66"/>
          <stop offset="100%" stop-color="#ffb347"/>
        </linearGradient>
        <filter id="soft" x="-20%" y="-40%" width="140%" height="180%">
          <feDropShadow dx="0" dy="8" stdDeviation="10" flood-color="#000" flood-opacity=".28"/>
        </filter>
      </defs>
      <!-- back light chevron -->
      <path d="M30,90 L260,10 L490,90 L490,160 Q490,170 480,170 L40,170 Q30,170 30,160 Z" fill="url(#g1)" filter="url(#soft)"/>
      <!-- front orange chevron -->
      <path d="M50,100 L260,30 L470,100 L470,160 Q470,170 460,170 L60,170 Q50,170 50,160 Z" fill="url(#g2)"/>
      <!-- white rounded base under chevrons to simulate card -->
      <rect x="60" y="120" width="400" height="48" rx="18" ry="18" fill="#ffffff" opacity="0.95"/>
    </svg>`;
  }

  function spawnOne({stat,amount,dur,sound}){
    const wrap=document.createElement('div');wrap.className='popup anim';wrap.style.setProperty('--dur',`${dur}ms`);
    const margin=120;const x=rand(margin,window.innerWidth-margin-260);const y=rand(margin,window.innerHeight-margin);
    wrap.style.left=x+'px';wrap.style.top=y+'px';

    const tile=document.createElement('div');tile.className='tile';tile.innerHTML=chevronSVG();
    const chip=document.createElement('div');chip.className='chip';chip.innerHTML=`<span class="plus">+${amount}</span><span class="stat">${stat}</span>`;
    tile.appendChild(chip);wrap.appendChild(tile);stage.appendChild(wrap);

    if(sound){try{sfxEl.currentTime=0;sfxEl.play().catch(()=>{})}catch(e){}}
    setTimeout(()=>wrap.remove(),dur+120);
  }

  async function batchSpawn(){
    const total=cfg.count;const fixed=cfg.amount??null;const jobs=[];
    for(let i=0;i<total;i++)jobs.push({stat:(cfg.mode==='v4_random')?choice(STAT_POOL):cfg.stat,amount:(fixed==null&&cfg.mode==='v4_random')?rand(1,20):(fixed??1),delay:rand(cfg.minDelay,cfg.maxDelay)});
    let inFlight=0,idx=0;return new Promise(res=>{function go(){while(inFlight<cfg.concurrent&&idx<jobs.length){const j=jobs[idx++];inFlight++;setTimeout(()=>{spawnOne({stat:j.stat,amount:j.amount,dur:cfg.dur,sound:cfg.sound});setTimeout(()=>{inFlight--;go();if(idx===jobs.length&&inFlight===0)res()},cfg.dur+150)},j.delay)} } go()});
  }

  (async()=>{await batchSpawn()})();
  </script>
</body>
</html>
